@page "/c_sucursales"
@inject HttpClient httpClient
@inject NotificationService notificationService;
@inject NavigationManager NavigationManager;

<div class="card">

    <div class="card-header ">
        <div class="col">
            <button @onclick="VolverAtras"><i class="bi bi-arrow-left-circle"></i></button>
        </div>
        <div class="col d-flex align-items-center justify-content-center">
            <img src="Images/pngwing.com.png" class="img-logo" />
            <h1>Consulta de Surcursales</h1>
        </div>
    </div>

    <div class="card-body">
        <div class="row">
            <div class="col">
                <select class="form-select" @bind="opciones">
                    <option value="0" disabled selected>Elija una opción</option>
                    <option value="1">Nombre sucursal</option>
                    <option value="2">Estado Operativo</option>
                </select>
            </div>
            <div class="col-3">
                @if (opciones == 1)
                {
                    <input type="text" class="form-control" @bind="FiltroString">
                }
                @if (opciones == 2)
                {
                    <select class="form-select" @bind="FiltroString">
                        <option value="0" disabled selected>Elija una opción</option>
                        <option value="Operativa">Operativa</option>
                        <option value="No operativa">No operativa</option>
                    </select>
                }
            </div>
            <div class="col">
                <label for="buscarButton">Buscar:</label>
                <div class="input-group">
                    <button @onclick="Buscar" class="btn btn-outline-primary" type="button" id="Buscar">
                        <i class="oi oi-magnifying-glass"></i>
                    </button>
                    <button @onclick="VaciarInputs" class="btn btn-outline-secondary" type="button" id="VaciarInputs">
                        <i class="oi oi-trash"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Direcci&oacute;n</th>
                        <th>Telefono</th>
                        <th>Estado Operativo</th>
                    </tr>
                </thead>
                <tbody>
                    @if (listaSucursales != null && listaSucursales.Any())
                    {
                        @foreach (var sucursal in listaSucursales)
                        {
                            <tr>
                                <td>@sucursal.Nombre</td>
                                <td>@sucursal.Direccion</td>
                                <td>@sucursal.Telefono</td>
                                <td>@(sucursal.EstadoOperativo ? "Operativo" : "No operativo")</td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="4">No hay sucursales</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@code {

    public List<Sucursales> listaSucursales;

    public string FiltroString { get; set; }
    public int opciones { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await Buscar();
    }

    public async Task Buscar()
    {
        listaSucursales = await httpClient.GetFromJsonAsync<List<Sucursales>>("api/Sucursales") ?? new List<Sucursales>();
        if (opciones == 1)
        {
            listaSucursales = listaSucursales.Where(s => s.Nombre.ToLower().Contains(FiltroString.ToLower())).ToList();
        }
        if (opciones == 2)
        {
            if (bool.TryParse(FiltroString, out bool estadoOperativo))
            {
                listaSucursales = listaSucursales.Where(s => s.EstadoOperativo == estadoOperativo).ToList();
            }
        }
    }

    private void VolverAtras()
    {
        NavigationManager.NavigateTo("/MenuSucursal");
    }

    public void VaciarInputs()
    {
        FiltroString = "";
    }

}
